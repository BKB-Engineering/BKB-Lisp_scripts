(define x_offset 2)
(define y_offset 67)
(import "pkg::disp-text@://vesc_packages/lib_disp_ui/disp_ui.vescpkg" 'disp-text)
(import "pkg::disp-text@://vesc_packages/lib_disp_ui/disp_ui.vescpkg" 'disp-text)

(import "res/soc_box.lisp" 'soc_box)
(import "fonts/font_9x14.bin" font_9x14)
(import "fonts/font_11x14_b.bin" font_11x14_b)
(import "fonts/font_20x30.bin" font_20x30)
(import "fonts/font_13x16_b.bin" font_13x16_b)
(import "res/speed_box.lisp" 'speed_box)
(import "res/dir_box.lisp" 'dir_box)
(import "res/conn_box.lisp" 'conn_box)
(import "res/mode_box.lisp" 'mode_box)
(import "res/amps_box.lisp" 'amps_box)
(import "res/trip_box.lisp" 'trip_box)
(import "screens/calib_screen.lisp" 'calib_screen)
(import "res/clear.lisp" 'clear)
(import "res/read_inputs.lisp" 'read_inputs)
(read-eval-program disp-text)
(read-eval-program speed_box)
(read-eval-program soc_box)
(read-eval-program dir_box)
(read-eval-program conn_box)
(read-eval-program mode_box)
(read-eval-program amps_box)
(read-eval-program trip_box)
(read-eval-program calib_screen)
(read-eval-program clear)
(read-eval-program read_inputs)

(disp-load-st7735 6 5 8 7 9 30) ; for some reason the first attempt to init is not succesful
(disp-load-st7735 6 5 8 7 9 30)
(disp-reset)
(ext-disp-orientation 2)


; drawing limit
;(def img (img-buffer 'indexed2 128 65))
;(img-rectangle img 0 0 127 63 1 '(rounded 0) '(dotted 5 5) '(thickness 1) )
;(disp-render img 0 0 '(0 0xFFFFFF))


(write_mode 0 2 20)
(write_online 0 95 19)
(write_direction 0 59 0)
(def count 100)
(bat_soc count 0 100 1 1 85 0)
(bat_soc count 36 48 0 0 8 0)
(write_amps 100.2 3 50)
(write_trip 150.4 0 65 50)


(write-speed 41.5 0 33 19 1)
(sleep 1)
(write-speed 41.5 0 33 19 2)
(sleep 1)
(write-speed 41.5 0 33 19 3)
(sleep 1)
(write-speed 41.5 0 33 19 3)
(sleep 1)
(write-speed 41.5 1 33 19 3)

(sleep 1)
(write_online 1 95 18)
(sleep 1)
(write_direction 0 59 0)
(sleep 1)
(write_direction 1 59 0)
(sleep 1)
(write_mode 0 2 20)
(sleep 1)
(write_mode 1 2 20)
(sleep 1)
(write_mode 2 2 20)
(sleep 1)
(write_mode 3 2 20)
(sleep 1)
(write_trip 150.4 1 65 50)

(loopwhile (< count 0) {
        (bat_soc count 0 100 1 1 85 0)
        (bat_soc count 36 48 0 0 8 0)
        (sleep 0.3)
        (setvar 'count (- count 1))
        (print count)
})
(clear_screen)
(calib_screen)

